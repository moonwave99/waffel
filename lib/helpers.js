// Generated by CoffeeScript 1.10.0
var _;

_ = require('lodash');

module.exports = {
  url: function(name, data, options) {
    var page, relativeUrl, wfl;
    if (data == null) {
      data = {};
    }
    if (options == null) {
      options = {};
    }
    _.merge(_.pick(arguments[arguments.length - 2], ['language', 'localised', 'page']), options);
    wfl = _.last(arguments);
    page = wfl._getPageByName(name);
    if (options.page) {
      page.pagination = {
        page: options.page
      };
    }
    if (wfl.options.uglyUrls) {
      relativeUrl = wfl._url(page, data, options);
      if (wfl.options.displayExt) {
        return (_.compact([wfl.options.domain, wfl.options.basePath, relativeUrl || 'index']).join('/')) + wfl.options.outputExt;
      } else {
        return _.compact([wfl.options.domain, wfl.options.basePath, relativeUrl]).join('/');
      }
    } else {
      return _.compact([wfl.options.domain, wfl.options.basePath, wfl._url(page, data, options), 'index.html']).join('/');
    }
  },
  asset: function(_path) {
    var wfl;
    if (_path == null) {
      _path = '';
    }
    wfl = _.last(arguments);
    return _.compact([wfl.options.domain, wfl.options.basePath, wfl.options.assetPath, _path]).join('/');
  },
  absoluteURL: function(url) {
    var wfl;
    wfl = _.last(arguments);
    return _.compact([wfl.options.domain, wfl.options.basePath, url]).join('/');
  },
  t: function(key) {
    var page, wfl;
    wfl = _.last(arguments);
    page = arguments[arguments.length - 2];
    return wfl.i18n(key, {
      lng: page.language
    });
  },
  loc: function(data, language) {
    var wfl;
    if (data == null) {
      data = {};
    }
    wfl = _.last(arguments);
    language = language || wfl.options.defaultLanguage;
    if (_.isArray(data)) {
      return data.map((function(_this) {
        return function(item) {
          if (item._localised) {
            return item[language] || item[wfl.options.fallbackLanguage];
          } else {
            return item;
          }
        };
      })(this));
    } else if (!data._localised) {
      return data;
    } else {
      return data[language] || data[wfl.options.fallbackLanguage];
    }
  }
};
